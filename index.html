<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qu·∫£n l√Ω Ho·∫°t ƒë·ªông H√†ng ng√†y</title>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
        }
        * {margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;}
        body {background:#f5f7fa;color:#333;line-height:1.6;}
        .container {max-width:1200px;margin:0 auto;padding:20px;}
        header {text-align:center;margin-bottom:30px;padding:20px;background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:white;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1);}
        h1 {font-size:2.2rem;margin-bottom:10px;}
        .tabs {display:flex;background:white;border-radius:10px 10px 0 0;overflow:hidden;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
        .tab {flex:1;padding:15px;text-align:center;cursor:pointer;transition:all 0.3s;font-weight:600;border-bottom:3px solid transparent;}
        .tab:hover {background:#f8f9fa;}
        .tab.active {border-bottom:3px solid var(--secondary-color);color:var(--secondary-color);background:#f8f9fa;}
        .tab-content {display:none;background:white;padding:25px;border-radius:0 0 10px 10px;box-shadow:0 2px 5px rgba(0,0,0,0.1);margin-bottom:30px;}
        .tab-content.active {display:block;animation:fadeIn 0.5s;}
        @keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
        .form-group {margin-bottom:20px;}
        label {display:block;margin-bottom:8px;font-weight:600;color:var(--primary-color);}
        input[type="date"], textarea {width:100%;padding:12px;border:1px solid #ddd;border-radius:5px;font-size:16px;}
        textarea {min-height:150px;resize:vertical;}
        .button-group {display:flex;gap:15px;margin-top:25px;}
        button {padding:12px 25px;border:none;border-radius:5px;cursor:pointer;font-size:16px;font-weight:600;transition:0.3s;display:flex;align-items:center;gap:8px;}
        .save-btn {background:var(--success-color);color:white;}
        .save-btn:hover {background:#219653;transform:translateY(-2px);}
        .edit-btn {background:var(--secondary-color);color:white;}
        .edit-btn:hover {background:#2980b9;transform:translateY(-2px);}
        .cancel-btn {background:#95a5a6;color:white;}
        .cancel-btn:hover {background:#7f8c8d;transform:translateY(-2px);}
        .activities-list {margin-top:30px;border-top:1px solid #eee;padding-top:20px;}
        .activity-item {background:#f8f9fa;padding:15px;margin-bottom:15px;border-radius:5px;border-left:4px solid var(--secondary-color);}
        .activity-date {font-weight:600;color:var(--primary-color);margin-bottom:5px;}
        .activity-content {color:#555;white-space:pre-wrap;}
        .activity-actions {margin-top:10px;display:flex;gap:10px;}
        .delete-btn {background:var(--accent-color);color:white;padding:5px 10px;font-size:14px;}
        .delete-btn:hover {background:#c0392b;}
        .empty-state {text-align:center;padding:30px;color:#7f8c8d;}
        .firebase-status {position:fixed;bottom:20px;right:20px;padding:10px 15px;border-radius:5px;font-size:14px;display:flex;align-items:center;gap:8px;}
        .status-connected {background:var(--success-color);color:white;}
        .status-disconnected {background:var(--accent-color);color:white;}
        @media (max-width:768px){.tabs{flex-direction:column;}.button-group{flex-direction:column;}button{width:100%;}}
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Qu·∫£n l√Ω Ho·∫°t ƒë·ªông H√†ng ng√†y</h1>
        <p>Ghi ch√©p v√† l∆∞u tr·ªØ c√°c ho·∫°t ƒë·ªông</p>
    </header>

    <div class="tabs">
        <div class="tab active" data-tab="mttq">MTTQ</div>
        <div class="tab" data-tab="doan">ƒêo√†n thanh ni√™n</div>
        <div class="tab" data-tab="phunu">H·ªôi ph·ª• n·ªØ</div>
        <div class="tab" data-tab="nguoicaotuoi">C·ª±u chi·∫øn binh</div>
    </div>

    <!-- Tab MTTQ -->
    <div class="tab-content active" id="mttq-tab">
        <h2>M·∫∑t tr·∫≠n T·ªï qu·ªëc</h2>
        <div class="form-group">
            <label for="mttq-date">Ng√†y th√°ng:</label>
            <input type="date" id="mttq-date">
        </div>
        <div class="form-group">
            <label for="mttq-text">N·ªôi dung ho·∫°t ƒë·ªông:</label>
            <textarea id="mttq-text"></textarea>
        </div>
        <div class="button-group">
            <button class="save-btn" id="mttq-save">üíæ L∆∞u</button>
            <button class="edit-btn" id="mttq-edit" style="display:none;">‚úèÔ∏è C·∫≠p nh·∫≠t</button>
            <button class="cancel-btn" id="mttq-cancel" style="display:none;">‚ùå H·ªßy</button>
        </div>
        <div class="activities-list" id="mttq-activities"></div>
    </div>

    <!-- Tab ƒêo√†n -->
    <div class="tab-content" id="doan-tab">
        <h2>ƒêo√†n thanh ni√™n</h2>
        <div class="form-group">
            <label for="doan-date">Ng√†y th√°ng:</label>
            <input type="date" id="doan-date">
        </div>
        <div class="form-group">
            <label for="doan-text">N·ªôi dung ho·∫°t ƒë·ªông:</label>
            <textarea id="doan-text"></textarea>
        </div>
        <div class="button-group">
            <button class="save-btn" id="doan-save">üíæ L∆∞u</button>
            <button class="edit-btn" id="doan-edit" style="display:none;">‚úèÔ∏è C·∫≠p nh·∫≠t</button>
            <button class="cancel-btn" id="doan-cancel" style="display:none;">‚ùå H·ªßy</button>
        </div>
        <div class="activities-list" id="doan-activities"></div>
    </div>

    <!-- Tab Ph·ª• n·ªØ -->
    <div class="tab-content" id="phunu-tab">
        <h2>H·ªôi ph·ª• n·ªØ</h2>
        <div class="form-group">
            <label for="phunu-date">Ng√†y th√°ng:</label>
            <input type="date" id="phunu-date">
        </div>
        <div class="form-group">
            <label for="phunu-text">N·ªôi dung ho·∫°t ƒë·ªông:</label>
            <textarea id="phunu-text"></textarea>
        </div>
        <div class="button-group">
            <button class="save-btn" id="phunu-save">üíæ L∆∞u</button>
            <button class="edit-btn" id="phunu-edit" style="display:none;">‚úèÔ∏è C·∫≠p nh·∫≠t</button>
            <button class="cancel-btn" id="phunu-cancel" style="display:none;">‚ùå H·ªßy</button>
        </div>
        <div class="activities-list" id="phunu-activities"></div>
    </div>

    <!-- Tab CCB -->
    <div class="tab-content" id="nguoicaotuoi-tab">
        <h2>H·ªôi C·ª±u chi·∫øn binh</h2>
        <div class="form-group">
            <label for="nguoicaotuoi-date">Ng√†y th√°ng:</label>
            <input type="date" id="nguoicaotuoi-date">
        </div>
        <div class="form-group">
            <label for="nguoicaotuoi-text">N·ªôi dung ho·∫°t ƒë·ªông:</label>
            <textarea id="nguoicaotuoi-text"></textarea>
        </div>
        <div class="button-group">
            <button class="save-btn" id="nguoicaotuoi-save">üíæ L∆∞u</button>
            <button class="edit-btn" id="nguoicaotuoi-edit" style="display:none;">‚úèÔ∏è C·∫≠p nh·∫≠t</button>
            <button class="cancel-btn" id="nguoicaotuoi-cancel" style="display:none;">‚ùå H·ªßy</button>
        </div>
        <div class="activities-list" id="nguoicaotuoi-activities"></div>
    </div>

    <div class="firebase-status" id="firebase-status">
        <span id="status-icon">üî¥</span>
        <span id="status-text">ƒêang k·∫øt n·ªëi...</span>
    </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCW3tCZI2GHbEsk5Vgq0KGDCi2KyQHzEnk",
  authDomain: "hoat-dong-hang-ngay.firebaseapp.com",
  databaseURL: "https://hoat-dong-hang-ngay-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "hoat-dong-hang-ngay",
  storageBucket: "hoat-dong-hang-ngay.appspot.com",
  messagingSenderId: "138829112865",
  appId: "1:138829112865:web:f9861d3990c5877516e560"
};

let database;
try {
    firebase.initializeApp(firebaseConfig);
    database = firebase.database();
    console.log("Firebase connected");
} catch (e) {alert("L·ªói Firebase: "+e.message);}

// Tab switching
document.querySelectorAll('.tab').forEach(tab=>{
  tab.addEventListener('click',()=>{
    document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
    tab.classList.add('active');
    const tabId=tab.getAttribute('data-tab');
    document.getElementById(`${tabId}-tab`).classList.add('active');
    loadActivities(tabId);
  });
});

// Utils
function formatDate(d){if(!d)return'';return new Date(d).toLocaleDateString('vi-VN');}

// Load data
function loadActivities(org){
  const list=document.getElementById(`${org}-activities`);
  list.innerHTML="<p>ƒêang t·∫£i...</p>";
  database.ref(`activities/${org}`).orderByChild('timestamp').once('value').then(snap=>{
    if(!snap.exists()){list.innerHTML="<p>Ch∆∞a c√≥ ho·∫°t ƒë·ªông</p>";return;}
    list.innerHTML="";
    let arr=[];snap.forEach(c=>arr.push({id:c.key,...c.val()}));
    arr.sort((a,b)=>b.timestamp-a.timestamp);
    arr.forEach(act=>{
      const div=document.createElement('div');
      div.className="activity-item";
      div.innerHTML=`<div class="activity-date">${formatDate(act.date)}</div>
      <div class="activity-content">${act.content}</div>
      <div class="activity-actions">
        <button class="edit-activity-btn" data-id="${act.id}">S·ª≠a</button>
        <button class="delete-btn delete-activity-btn" data-id="${act.id}">X√≥a</button>
      </div>`;
      list.appendChild(div);
    });
    addEvents(org);
  });
}
function addEvents(org){
  document.querySelectorAll(`#${org}-activities .edit-activity-btn`).forEach(b=>{
    b.onclick=()=>editActivity(org,b.dataset.id);
  });
  document.querySelectorAll(`#${org}-activities .delete-activity-btn`).forEach(b=>{
    b.onclick=()=>deleteActivity(org,b.dataset.id);
  });
}
function saveActivity(org){
  const date=document.getElementById(`${org}-date`).value;
  const text=document.getElementById(`${org}-text`).value.trim();
  if(!date||!text){alert("Nh·∫≠p ƒë·ªß th√¥ng tin");return;}
  database.ref(`activities/${org}`).push({date,content:text,timestamp:firebase.database.ServerValue.TIMESTAMP}).then(()=>{
    resetForm(org);   // ‚úÖ Xo√° r·ªóng form sau khi l∆∞u
    loadActivities(org);
  });
}
function editActivity(org,id){
  database.ref(`activities/${org}/${id}`).once('value').then(s=>{
    const a=s.val();
    document.getElementById(`${org}-date`).value=a.date;
    document.getElementById(`${org}-text`).value=a.content;
    document.getElementById(`${org}-save`).style.display='none';
    document.getElementById(`${org}-edit`).style.display='inline-flex';
    document.getElementById(`${org}-cancel`).style.display='inline-flex';
    document.getElementById(`${org}-edit`).dataset.editId=id;
  });
}
function updateActivity(org){
  const id=document.getElementById(`${org}-edit`).dataset.editId;
  const date=document.getElementById(`${org}-date`).value;
  const text=document.getElementById(`${org}-text`).value.trim();
  database.ref(`activities/${org}/${id}`).update({date,content:text,timestamp:firebase.database.ServerValue.TIMESTAMP}).then(()=>{
    resetForm(org);loadActivities(org);
  });
}
function deleteActivity(org,id){if(confirm("X√≥a?"))database.ref(`activities/${org}/${id}`).remove().then(()=>loadActivities(org));}
function resetForm(org){
  document.getElementById(`${org}-date`).value='';
  document.getElementById(`${org}-text`).value='';
  document.getElementById(`${org}-save`).style.display='inline-flex';
  document.getElementById(`${org}-edit`).style.display='none';
  document.getElementById(`${org}-cancel`).style.display='none';
}
document.addEventListener("DOMContentLoaded",()=>{
  const today=new Date().toISOString().split('T')[0];
  document.querySelectorAll('input[type="date"]').forEach(i=>i.value=today);
  loadActivities('mttq');
});
['mttq','doan','phunu','nguoicaotuoi'].forEach(org=>{
  document.getElementById(`${org}-save`).onclick=()=>saveActivity(org);
  document.getElementById(`${org}-edit`).onclick=()=>updateActivity(org);
  document.getElementById(`${org}-cancel`).onclick=()=>resetForm(org);
});
</script>
</body>
</html>
